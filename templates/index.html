<!DOCTYPE html>
<html lang="{{lang}}">
<head> 
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}" type="image/x-icon">
    <title>QuizzSpark | AI Quiz Generator for Any Topic</title>
    <meta name="description" content="Spark your curiosity! Create a custom quiz on any topic in seconds with QuizzSpark's powerful AI generator. From history to science, test your knowledge instantly.">
    <meta property="og:title" content="QuizzSpark | AI Quiz Generator for Any Topic">
    <meta property="og:description" content="Create a custom quiz on any topic in seconds with QuizzSpark's powerful AI generator.">
    <meta property="og:image" content="{{ url_for('static', filename='share-card.png', _external=True) }}">
    <meta property="og:url" content="https://www.quizzspark.com/">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "FAQPage",
        "mainEntity": [{
            "@type": "Question",
            "name": "Is this AI quiz generator truly free to use?",
            "acceptedAnswer": {
            "@type": "Answer",
            "text": "Yes, 100%! QuizzSpark is a completely free quiz maker. There are no hidden costs, no premium versions, and no limits on how many quizzes you can create."
            }
        },{
            "@type": "Question",
            "name": "Do I need to create an account or sign up?",
            "acceptedAnswer": {
            "@type": "Answer",
            "text": "No. We believe in instant access. You can start creating your quiz the moment you land on our page, with no sign-up required."
            }
        },{
            "@type": "Question",
            "name": "What topics can I create a quiz on?",
            "acceptedAnswer": {
            "@type": "Answer",
            "text": "Any topic you can imagine! Our AI can generate a custom quiz on anything from Indian history and physics to Taylor Swift and the latest IPL season."
            }
        },{
            "@type": "Question",
            "name": "What type of questions does it generate?",
            "acceptedAnswer": {
            "@type": "Answer",
            "text": "QuizzSpark is a multiple-choice quiz maker. It automatically generates questions with four distinct options for each one."
            }
        },{
            "@type": "Question",
            "name": "Who is this tool for?",
            "acceptedAnswer": {
            "@type": "Answer",
            "text": "Our free online test creator is perfect for teachers making classroom assignments, students creating study guides, or anyone who wants to make a trivia quiz for fun."
            }
        }]
    }
</script>
<script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "QuizzSpark",
      "applicationCategory": "EducationalApplication",
      "operatingSystem": "Any",
      "description": "An AI-powered quiz generator that creates custom quizzes on any topic instantly.",
      "url": "https://www.quizzspark.com/",
      "offers": {
        "@type": "Offer",
        "price": "0"
      }
    }
</script>
</head>
<body>

    <div class="site-brand">
        <a href="/">QuizzSpark</a>
    </div>

    <canvas id="hero-canvas"></canvas>

    <!-- Language Selector -->
    <div class="language-selector">
    <select id="language-select">
        <option value="en" selected>üá¨üáß English</option>
        <option value="es">üá™üá∏ Espa√±ol</option>
        <option value="fr">üá´üá∑ Fran√ßais</option>
        <option value="hi">üáÆüá≥ ‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</option>
        
    </select>
    </div>
    <div id="google_translate_element" style="display:none;"></div>


    <section class="hero interactive-hero">

        

        <div class="hero-content">
            <h1>{{ _('The shortest path from curious to genius')}}</h1>
            <p>{{ _('It all starts with a single word. What are you curious about?')}}</p>

            <div id="unified-form-container" class="unified-form-container">
            <div class="input-row">
                <button id="hero-start-btn" aria-label="Start Quiz Creation">
                    {{ _('Enter a topic...')}}
                </button>
                <input type="text" id="hero-topic-input" placeholder="{{ _('e.g., The Roman Empire, Quantum Physics, Indian History...')}}" autocomplete="off">
            </div>
            <div class="topic-suggestions">
                <button class="suggestion-chip">{{ _('Science')}}</button>
                <button class="suggestion-chip">{{ _('History')}}</button>
                <button class="suggestion-chip">{{ _('üáÆüá≥ Indian Premier League')}}</button>
                <button class="suggestion-chip">{{ _('Surprise Me! ‚ú®')}}</button>
            </div>
            <div class="options-row">
                <div class="option-item">
                    <label for="hero-difficulty">{{ _('Difficulty')}}</label>
                    <select id="hero-difficulty">
                        <option value="easy">{{ _('Easy')}}</option>
                        <option value="medium" selected>{{ _('Medium')}}</option>
                        <option value="hard">{{ _('Hard')}}</option>
                    </select>
                </div>
                <div class="option-item">
                    <label for="hero-numQuestions">{{ _('Questions')}}</label>
                    <input type="number" id="hero-numQuestions" value="5" min="1" max="50">
                </div>
                <button href="#quiz-section" id="hero-generate-link" class="cta-button final-generate-btn">Generate</button>
            </div>
        </div>
    </section>

  <!-- Features Section -->
  <section class="features">
    <h2>{{ _('Why Choose Us?')}}</h2>
    <div class="features-grid">
      <div class="feature-card">
        <h3>{{ _('üß† Limitless Topics')}}</h3>
        <p>{{ _('Never take the same quiz twice. <strong>Create a study quiz from notes</strong> on astrophysics or <strong>make a trivia quiz for fun</strong> about 18th-century art. Our engine helps you <strong>create your own quiz</strong> on any topic imaginable.')}}</p>
      </div>
      <div class="feature-card">
        <h3>{{ _('üßó Your Perfect Challenge')}}</h3>
        <p>{{ _('Just starting out or ready for the final boss? Choose your difficulty and test your knowledge at the right level for you.')}}</p>
      </div>
      <div class="feature-card">
        <h3>{{ _('üì§ Share Results')}}</h3>
        <p>{{ _('Aced that tough quiz? Share your score card with a single click and challenge your friends to beat you.')}}</p>
      </div>
      <div class="feature-card">
        <h3>{{ _('üöÄ Instant Access, Completely Free')}}</h3>
        <p>{{ _('Jump straight into creating. No accounts, no sign-ups, no credit cards required. Your next quiz is just one click away.')}}</p>
      </div>
    </div>
  </section>

   <section id="quiz-section" class="quiz-section">
    <div class="container">
        <div id="setup-container">
            <header>
                <h1>{{ _('Ready for Another Challenge?')}}</h1>
                <p>{{ _('The learning never stops. Pick your next topic below.')}}</p>
            </header>
<form id="quiz-form">
    <div class="form-group">
        <label for="topic">{{ _('Topic')}}</label>
        <input type="text" id="topic" placeholder="e.g., 'The Solar System'" required>
    </div>
    
    <div class="form-row">
        <div class="form-group">
            <label for="difficulty">{{ _('Difficulty level')}}</label>
            <div class="select-wrapper">
                <select id="difficulty">
                    <option value="easy">{{ _('Easy')}}</option>
                    <option value="medium" selected>{{ _('Medium')}}</option>
                    <option value="hard">{{ _('Hard')}}</option>
                </select>
            </div>
        </div>
        <div class="form-group">
            <label for="numQuestions">{{ _('Number of Questions')}}</label>
            <input type="number" id="numQuestions" value="5" min="1" max="50" required>
        </div>
    </div>

    <button type="button" id="generate-btn" class="cta-button final-generate-btn">{{ _('Spark the Quiz!?')}}</button>
</form>
             <p id="error-message"></p>
        </div>

        <div id="loading-container" class="hidden">
            <div class="spinner"></div>
            <p>{{ _('Building your challenge...')}}</p>
        </div>

        <div id="quiz-container" class="hidden">
            </div>

        <div id="results-container" class="hidden">
            
            </div>

    </div>
</section>

<section class="how-it-works">
    <h2>{{ _('Your Instant AI Quiz Generator') }}</h2>
    <p>{{ _('QuizzSpark is a free online test creator designed for students, teachers, and curious minds in India and across the world. We believe that creating a custom quiz should be simple and instant. Here‚Äôs how our quiz maker brings any topic to life in under a minute:') }}</p>
    
    <div class="steps-grid">
        <div class="step-card">
            <h3>{{ _('1. Enter Any Topic') }}</h3>
            <p>{{ _('Simply type any subject into the box ‚Äì from the IPL to quantum physics. Our AI is ready to generate a quiz on any topic you can imagine.') }}</p>
        </div>
        <div class="step-card">
            <h3>{{ _('2. Customize Your Test') }}</h3>
            <p>{{ _('Choose your desired difficulty and the number of multiple-choice questions. It‚Äôs the perfect custom quiz maker for any study session or classroom activity.') }}</p>
        </div>
        <div class="step-card">
            <h3>{{ _('3. Spark Your Quiz!') }}</h3>
            <p>{{ _('Click the button to instantly receive your unique quiz. Challenge yourself, share with friends, or use it to prepare for an exam. It‚Äôs that easy!') }}</p>
        </div>
    </div>
</section>

<section class="faq-section">
    <h2>{{ _('Frequently Asked Questions') }}</h2>

    <div class="faq-item">
        <h3>{{ _('Is this AI quiz generator truly free to use?') }}</h3>
        <p>{{ _('Yes, 100%%! QuizzSpark is a completely free quiz maker. There are no hidden costs, no premium versions, and no limits on how many quizzes you can create.') }}</p>
    </div>

    <div class="faq-item">
        <h3>{{ _('Do I need to create an account or sign up?') }}</h3>
        <p>{{ _('No. We believe in instant access. You can start creating your quiz the moment you land on our page, with no sign-up required.') }}</p>
    </div>

    <div class="faq-item">
        <h3>{{ _('What topics can I create a quiz on?') }}</h3>
        <p>{{ _('Any topic you can imagine! Our AI can generate a custom quiz on anything from Indian history and physics to Taylor Swift and the latest IPL season.') }}</p>
    </div>

    <div class="faq-item">
        <h3>{{ _('What type of questions does it generate?') }}</h3>
        <p>{{ _('QuizzSpark is a multiple-choice quiz maker. It automatically generates questions with four distinct options for each one.') }}</p>
    </div>

    <div class="faq-item">
        <h3>{{ _('Who is this tool for?') }}</h3>
        <p>{{ _('Our free online test creator is perfect for teachers making classroom assignments, students creating study guides, or anyone who wants to make a trivia quiz for fun.') }}</p>
    </div>
</section>

<footer class="site-footer">
  <p class="app-info">{{ _('QuizzSpark ‚Äì Where curiosity meets its match.')}}</p>
  <p class="legal">{{ _('¬© 2025 QuizzSpark. All rights reserved. Happy quizzing!')}}</p>
</footer>

<script>

    const translations = {
        en: {
            quizComplete: "üéâ Quiz Complete! üéâ",
            youScored: "You scored",
            topic: "Topic",
            difficulty: "Difficulty",
            reviewAnswers: "Review Your Answers",
            yourAnswer: "Your answer",
            notAnswered: "Not answered",
            correctAnswer: "Correct answer",
            tryAnotherQuiz: "Try Another Quiz",
            submitQuiz: "Submit Quiz",
            share: "Share",
            download: "Download",
            downloadQuizPdf: "Download Quiz PDF"
        },
        es: {
            quizComplete: "üéâ ¬°Prueba Completada! üéâ",
            youScored: "Obtuviste",
            topic: "Tema",
            difficulty: "Dificultad",
            reviewAnswers: "Revisa Tus Respuestas",
            yourAnswer: "Tu respuesta",
            notAnswered: "No respondido",
            correctAnswer: "Respuesta correcta",
            tryAnotherQuiz: "Probar Otro Cuestionario",
            submitQuiz: "Enviar cuestionario",
            share: "Compartir",
            download: "Descargar el ",
            downloadQuizPdf: "cuestionario en PDF"
        },
        fr: {
            quizComplete: "üéâ Quiz Termin√© ! üéâ",
            youScored: "Votre score",
            topic: "Sujet",
            difficulty: "Difficult√©",
            reviewAnswers: "R√©visez Vos R√©ponses",
            yourAnswer: "Votre r√©ponse",
            notAnswered: "Pas de r√©ponse",
            correctAnswer: "Bonne r√©ponse",
            tryAnotherQuiz: "Essayer un Autre Quiz",
            submitQuiz: "Soumettre le questionnaire",
            share: "Partager",
            download: "T√©l√©charger le quiz",
            downloadQuizPdf: "au format PDF"
        },
        hi: {
            quizComplete: "üéâ ‡§™‡•ç‡§∞‡§∂‡•ç‡§®‡•ã‡§§‡•ç‡§§‡§∞‡•Ä ‡§™‡•Ç‡§∞‡•Ä ‡§π‡•Å‡§à! üéâ",
            youScored: "‡§Ü‡§™‡§ï‡§æ ‡§∏‡•ç‡§ï‡•ã‡§∞",
            topic: "‡§µ‡§ø‡§∑‡§Ø",
            difficulty: "‡§ï‡§†‡§ø‡§®‡§æ‡§à",
            reviewAnswers: "‡§Ö‡§™‡§®‡•á ‡§â‡§§‡•ç‡§§‡§∞‡•ã‡§Ç ‡§ï‡•Ä ‡§∏‡§Æ‡•Ä‡§ï‡•ç‡§∑‡§æ ‡§ï‡§∞‡•á‡§Ç",
            yourAnswer: "‡§Ü‡§™‡§ï‡§æ ‡§â‡§§‡•ç‡§§‡§∞",
            notAnswered: "‡§ï‡•ã‡§à ‡§â‡§§‡•ç‡§§‡§∞ ‡§®‡§π‡•Ä‡§Ç ‡§¶‡§ø‡§Ø‡§æ",
            correctAnswer: "‡§∏‡§π‡•Ä ‡§â‡§§‡•ç‡§§‡§∞",
            tryAnotherQuiz: "‡§è‡§ï ‡§î‡§∞ ‡§™‡•ç‡§∞‡§∂‡•ç‡§®‡•ã‡§§‡•ç‡§§‡§∞‡•Ä ‡§ï‡§æ ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç",
            submitQuiz: "‡§™‡•ç‡§∞‡§∂‡•ç‡§®‡•ã‡§§‡•ç‡§§‡§∞‡•Ä ‡§∏‡§¨‡§Æ‡§ø‡§ü ‡§ï‡§∞‡•á‡§Ç",
            share: "‡§∂‡•á‡§Ø‡§∞ ‡§ï‡§∞‡•á‡§Ç",
            download: "‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç",
            downloadQuizPdf: "‡§™‡•Ä‡§°‡•Ä‡§è‡§´‡§º ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç"
        }
    };

    document.addEventListener('DOMContentLoaded', () => {
        // =================================================================
        // View & Container Selectors
        // =================================================================
        const quizSection = document.getElementById('quiz-section');
        const setupContainer = document.getElementById('setup-container');
        const loadingContainer = document.getElementById('loading-container');
        const quizContainer = document.getElementById('quiz-container');
        const resultsContainer = document.getElementById('results-container');

        // =================================================================
        // Main & Hero Form Selectors
        // =================================================================
        const mainTopicInput = document.getElementById('topic');
        const mainDifficultySelect = document.getElementById('difficulty');
        const mainNumQuestionsInput = document.getElementById('numQuestions');
        const unifiedFormContainer = document.getElementById('unified-form-container');
        const heroTopicInput = document.getElementById('hero-topic-input');
        const heroStartBtn = document.getElementById('hero-start-btn');
        const heroGenerateLink = document.getElementById('hero-generate-link');
        const heroDifficultySelect = document.getElementById('hero-difficulty');
        const heroNumQuestionsInput = document.getElementById('hero-numQuestions');
        const errorMessage = document.getElementById('error-message');

        

     

        // Send language choice to backend and auto-refresh
        document.getElementById("language-select").addEventListener("change", async function () {
            const lang = this.value;
            localStorage.setItem("selectedLang", lang);
            
            try {
                const response = await fetch("/set-language", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ language: lang })
                });
                
                // If the server confirms the change, reload the page
                if (response.ok) {
                    location.reload(); 
                } else {
                    console.error("Failed to set language on the server.");
                }
            } catch (error) {
                console.error("Error sending language choice:", error);
            }
        });


        // =================================================================
        // Core Application Logic (sendQuery, renderQuiz, etc.)
        // =================================================================
        
        // (Paste your complete `showView`, `sendQuery`, `renderQuiz`, `submitQuiz`, 
        // `showResults`, and `downloadScoreCard` functions here exactly as they were before)
        
        // Example structure:
        function showView(view) {
            [setupContainer, loadingContainer, quizContainer, resultsContainer].forEach(v => v.classList.add('hidden'));
            view.classList.remove('hidden');
            view.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        

        async function sendQuery(topic, difficulty, numQuestions) {
        if (!topic) {
            // Find which form is visible to shake it
            const visibleForm = document.getElementById('unified-form-container').offsetParent ? 
                                document.getElementById('unified-form-container') : 
                                document.getElementById('quiz-form');
            visibleForm.classList.add('shake');
            setTimeout(() => visibleForm.classList.remove('shake'), 500);
            return;
        }
        if (numQuestions < 1 || numQuestions > 50) {
            alert("Please choose between 1 and 50 questions.");
            return;
        }
        errorMessage.textContent = "";
        showView(loadingContainer);

        try {
            const response = await fetch('/ask-gemini', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ topic, difficulty, num_questions: numQuestions })
            });

            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.error || 'An unknown error occurred.');
            }
            
            const data = await response.json();
            renderQuiz(data.quiz);
            showView(quizContainer);
        } catch (error) {
            errorMessage.textContent = `Error: ${error.message}`;
            alert(`Error: ${error.message}`);
            unifiedFormContainer.classList.remove('expanded');
            heroStartBtn.disabled = false;
            showView(setupContainer);
        }
    }

        

        function renderQuiz(quiz) {
            const lang = document.documentElement.lang.replace('-', '_') || 'en';
            const t = translations[lang] || translations.en;

            quizContainer.innerHTML = ''; 

            quiz.forEach((q, index) => {
                const questionCard = document.createElement('div');
                questionCard.className = 'question-card';
                
                const questionText = document.createElement('p');
                questionText.className = 'question-text';
                questionText.textContent = `${index + 1}. ${q.question}`;
                questionCard.appendChild(questionText);

                const optionsGrid = document.createElement('div');
                optionsGrid.className = 'options-grid';

                q.options.forEach(opt => {
                    const label = document.createElement('label');
                    label.className = 'option-label';
                    
                    const input = document.createElement('input');
                    input.type = 'radio';
                    input.name = `q${index}`;
                    input.value = opt;

                    const span = document.createElement('span');
                    span.className = 'option-text';
                    span.textContent = opt;

                    label.appendChild(input);
                    label.appendChild(span);
                    optionsGrid.appendChild(label);
                });
                questionCard.appendChild(optionsGrid);
                quizContainer.appendChild(questionCard);
            });

            const submitBtn = document.createElement('button');
            submitBtn.textContent = t.submitQuiz;
            submitBtn.id = "submit-btn";
            submitBtn.className="cta-button final-generate-btn";
            submitBtn.onclick = submitQuiz;
            quizContainer.appendChild(submitBtn);

            // triggerTranslationDebounced();
        }

        async function submitQuiz() {
            const userAnswers = [];
            const questionCards = document.querySelectorAll('.question-card');
            let allAnswered = true;

            questionCards.forEach((card, index) => {
                const selected = card.querySelector(`input[name="q${index}"]:checked`);
                card.classList.remove('unanswered');
                if (selected) {
                    userAnswers.push(selected.value);
                } else {
                    userAnswers.push(null);
                    card.classList.add('unanswered');
                    allAnswered = false;
                }
            });

            if (!allAnswered) {
                alert('Please answer all questions before submitting.');
                return;
            }

            showView(loadingContainer);

            try {
                const response = await fetch('/submit-quiz', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ answers: userAnswers })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || 'Failed to submit quiz.');
                }

                const result = await response.json();
                showResults(result);
            } catch (err) {
                console.error("Error submitting quiz:", err);
                errorMessage.textContent = `Error: ${err.message}`;
                showView(setupContainer);
            }
        }


        function showResults(result) {
            // Get current language from the <html> tag, default to 'en'
            const lang = document.documentElement.lang.replace('-', '_') || 'en';
            const t = translations[lang] || translations.en; // Get the right set of translations

            resultsContainer.innerHTML = ``;

            const scoreCard = document.createElement('div');
            scoreCard.className = 'score-card';
            scoreCard.innerHTML = `
                <h2>üéâ ${t.quizComplete}! üéâ</h2>
                <p class="score-text">${t.youScored}</p>
                <p class="score-display"><strong>${result.score}</strong> / ${result.total}</p>
                <p class="quiz-info">${t.topic}: <strong>${result.topic}</strong></p>
                <p class="quiz-info">${t.difficulty}: <strong>${result.difficulty}</strong></p>
                <div class="score-card-actions">
                    <button id="shareTwitter" class="cta-button final-generate-btn">${t.share}</button>
                    <button id="downloadCard" class="cta-button final-generate-btn">${t.download}</button>
                    <button id="downloadPDF" class="cta-button final-generate-btn">${t.downloadQuizPdf}</button>
                </div>
            `;
            resultsContainer.appendChild(scoreCard);

            


            // Optionally show feedback with correct answers
            const feedbackHeader = document.createElement('h3');
            feedbackHeader.textContent = t.reviewAnswers;
            resultsContainer.appendChild(feedbackHeader);

            result.feedback.forEach(fb => {
                const el = document.createElement('div');
                el.className = `feedback-item ${fb.is_correct ? 'correct' : 'incorrect'}`;
                el.innerHTML = `
                    <p><strong>Q${fb.question_number}:</strong> ${t.yourAnswer}: ${fb.user_answer || t.notAnswered}</p>
                    <p>${t.correctAnswer}: <strong>${fb.correct_answer}</strong></p>
                `;
                resultsContainer.appendChild(el);
            });
            
            const tryAgainBtn = document.createElement('button');
            tryAgainBtn.textContent = t.tryAnotherQuiz;
            tryAgainBtn.id = 'try-again-btn';
            tryAgainBtn.className = "cta-button final-generate-btn";
            tryAgainBtn.onclick = () => showView(setupContainer);
            resultsContainer.appendChild(tryAgainBtn);

            document.getElementById('shareTwitter').addEventListener('click', (e) => {
            e.preventDefault();

            // Grab score data
            const score = document.querySelector('.score-display strong')?.textContent || '';
            const total = document.querySelector('.score-display')?.textContent.split('/')[1]?.trim() || '';
            const topic = document.querySelector('.quiz-info strong')?.textContent || '';
            const diffEl = document.querySelectorAll('.quiz-info strong')[1];
            const difficulty = diffEl ? diffEl.textContent : '';

            // Build the tweet text
            const text = `üèÜ I just scored ${score}/${total} on the "${topic}" quiz (${difficulty})!\n\n` +
                        `üöÄ Think you can beat me?\nüëâ Try it now: QuizzSpark.com/quiz\n\n` +
                        `#Python #Flask #Quiz #WebDev`;

            // Open Twitter share window directly (popup-safe)
            const intent = `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}`;
            window.open(intent, 'twitter-share-dialog', 'width=600,height=500');
        });




            
            document.getElementById('downloadCard').addEventListener('click', downloadScoreCard);
            document.getElementById('downloadPDF').addEventListener('click', () => {
                window.open('/download_pdf', '_blank');
            });

            showView(resultsContainer);
            // triggerTranslationDebounced();
        }
        
        async function downloadScoreCard() {
            const scoreCard = document.querySelector('.score-card');
            // Temporarily change background for download
            scoreCard.style.setProperty('--surface-color-temp', '#1e1e1e');
            
            const canvas = await html2canvas(scoreCard, {
                 backgroundColor: '#121212', // Match body background
                 onclone: (clonedDoc) => {
                    const clonedCard = clonedDoc.querySelector('.score-card');
                    clonedCard.style.backgroundColor = getComputedStyle(clonedCard).getPropertyValue('--surface-color-temp');
                }
            
            });

            scoreCard.style.removeProperty('--surface-color-temp');

            const link = document.createElement('a');
            link.download = 'gemini-quiz-score.png';
            link.href = canvas.toDataURL();
            link.click();
        }


        // =================================================================
        // Event Listeners (Hero Form & Suggestions)
        // =================================================================
        function revealOptions() {
            if (heroTopicInput.value.trim() === "") {
                unifiedFormContainer.classList.add('shake');
                setTimeout(() => unifiedFormContainer.classList.remove('shake'), 500);
                return;
            }
            unifiedFormContainer.classList.add('expanded');
            heroStartBtn.disabled = true; 
        }
        heroStartBtn.addEventListener('click', revealOptions);
        heroTopicInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') { e.preventDefault(); revealOptions(); }
        });
        // heroGenerateLink.addEventListener('click', (e) => {
        //     e.preventDefault();
        //     sendQuery();
        // });

        heroGenerateLink.addEventListener('click', (e) => {
            e.preventDefault();
            const topic = heroTopicInput.value.trim();
            const difficulty = heroDifficultySelect.value;
            const numQuestions = parseInt(heroNumQuestionsInput.value, 10);
            sendQuery(topic, difficulty, numQuestions);
        });

        // Add this new listener for the second form's button
        const generateBtn = document.getElementById('generate-btn');
        generateBtn.addEventListener('click', (e) => {
            e.preventDefault();
            const topic = mainTopicInput.value.trim();
            const difficulty = mainDifficultySelect.value;
            const numQuestions = parseInt(mainNumQuestionsInput.value, 10);
            sendQuery(topic, difficulty, numQuestions);
        });

        const suggestionsContainer = document.querySelector('.topic-suggestions');
        suggestionsContainer.addEventListener('click', (e) => {
            if (e.target.classList.contains('suggestion-chip')) {
                const topic = e.target.textContent;
                if (topic.includes('Surprise Me!')) {
                    const randomTopics = ['The History of Coffee', 'Unusual Animal Facts', 'Ancient Egyptian Mythology', 'The Science of Fireworks', 'Famous Shipwrecks'];
                    heroTopicInput.value = randomTopics[Math.floor(Math.random() * randomTopics.length)];
                } else {
                    heroTopicInput.value = topic.replace(/[\u{1F600}-\u{1F64F}\u{1F300}-\u{1F5FF}\u{1F680}-\u{1F6FF}\u{1F700}-\u{1F77F}\u{1F780}-\u{1F7FF}\u{1F800}-\u{1F8FF}\u{1F900}-\u{1F9FF}\u{1FA00}-\u{1FA6F}\u{1FA70}-\u{1FAFF}\u{2600}-\u{26FF}\u{2700}-\u{27BF}]/gu, '').trim();
                }
                revealOptions();
            }
        });

        // =================================================================
        // Dynamic Background Canvas
        // =================================================================
        const canvas = document.getElementById('hero-canvas');
        if (canvas) {
            const ctx = canvas.getContext('2d');
            let width, height, particles;
            const particleProps = { max: 100, speed: 0.5, radius: 2, lineDist: 120, color: 'rgba(3, 218, 198, 0.5)' };
            const init = () => {
                const heroSection = document.querySelector('.interactive-hero');
                if (!heroSection) return;
                
                // Set canvas size to cover the entire viewport
                width = canvas.width = window.innerWidth;
                height = canvas.height = window.innerHeight;

                particles = Array.from({ length: particleProps.max }, () => ({ 
                    x: Math.random() * width, 
                    y: Math.random() * height, 
                    vx: (Math.random() - 0.5) * particleProps.speed, 
                    vy: (Math.random() - 0.5) * particleProps.speed 
                }));
            };
            const draw = () => {
                if (!ctx || !particles) return;
                requestAnimationFrame(draw); // Move this to the top for a safer loop
                ctx.clearRect(0, 0, width, height);
                particles.forEach(p1 => {
                    p1.x += p1.vx; p1.y += p1.vy;
                    if (p1.x < 0 || p1.x > width) p1.vx *= -1;
                    if (p1.y < 0 || p1.y > height) p1.vy *= -1;
                    ctx.beginPath(); ctx.arc(p1.x, p1.y, particleProps.radius, 0, Math.PI * 2); ctx.fillStyle = particleProps.color; ctx.fill();
                    particles.forEach(p2 => {
                        const dist = Math.hypot(p1.x - p2.x, p1.y - p2.y);
                        if (dist < particleProps.lineDist) {
                            ctx.beginPath(); ctx.moveTo(p1.x, p1.y); ctx.lineTo(p2.x, p2.y);
                            ctx.strokeStyle = `rgba(3, 218, 198, ${1 - dist / particleProps.lineDist})`;
                            ctx.stroke();
                        }
                    });
                });
            };
            init();
            draw();
            window.addEventListener('resize', init);
        }

        

        // Send language choice to backend
        document.getElementById("language-select").addEventListener("change", async function () {
            const lang = this.value;
            localStorage.setItem("selectedLang", lang);
            // Save to session on server
            await fetch("/set-language", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ language: lang })
            });
        });


        // Restore user‚Äôs saved language choice on page load
        const savedLang = localStorage.getItem("selectedLang");
        if (savedLang) {
            document.getElementById("language-select").value = savedLang;
            // Optionally sync session immediately
            fetch("/set-language", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ language: savedLang })
            });
        }        

    }); // End of DOMContentLoaded
</script>


  
    <script src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script> 


</body>
</html>
